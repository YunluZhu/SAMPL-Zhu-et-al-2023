# Introduction

The VF analysis package reads LabView .dlm files generated by free swimming vertical fish apparatus (preprocessing), extracts and analyzes bouts (grab_fish_angle), and make figures (visualization).

For the current version (v1_0_200801), users need to run "vf_analysis_by_folder.py" or "vf_analysis_test.py" to analyze .dlm files. The "_cli.py" takes command line inputs and can be ran from terminal.

Analyzed results will be saved in the original directories with .dlm files in hdf5 format.
Then, run individual visualization scripts to make figures. Interactive console is recommended for running visualizations.
For more details, see the instructions section.

## Prerequisites and tips

1. Conda environment is recommended. Download miniconda here: <https://docs.conda.io/en/latest/miniconda.html>
2. To get packages required for running the code, try loading the docs/yzvf.yml file. If it failes, just create a new environment and install packages required according to the docs/pkgs.txt.
3. Setting up conda envs can be the most time-consuming step. Be patient and google a lot.
4. Visual Studio Code is a good IDE and is compatible with Jupyter Notebook
5. VS code Python Extension supports Interactive Window
    - You can create cells on a Python file by typing "#%%" 
- Use "Shift + Enter " to run a cell, the output will be shown in the interactive window

## Quick Start Guide

0. Organize .dlm files. Each folder with .dlm files will be recognized as one "experiment (exp)" during jackknife analysis. Therefore, if you want to combine all data from a certain clutch, put them into the same folder. Required folder structure:
├─ root
	├─ 7dd_ctrl
		├─ 200607 xxx 
			├─ xxx.dlm
			├─ xxx.dlm
			├─ xxx.dlm
		├─ 200611 xxx 
			├─ xxx.dlm
			├─ xxx.dlm
	├─ 7dd_condition
		├─ 200611 xxx 
			|- ...
		├─ 200611 xxx 
			|- ...
	├─ 4dd_ctrl
		|- ...

Note: 
7dd_ctrl: one digit/character (dpf) + two letters (light-dark condition) + _ + flexible (condition)
200607 xxx: start with 6 digits (exp date) + flexible
1. Get the root directory of .dlm files and run vf_analysis_by_folder_cli.py. It will go through all subfolders, find .dlm files, call the 2 functions in preprocessing, save analyzed results in .dlm folders.
    - alternatively, you may run the "vf_analysis_test.py" which only analyzes .dlm files under the given directory.
    - for both scripts, .dlm files with the same path (under the same folder) will be analyzed together. Results from all the .dlm files will be concatenated.

2. Run visualization scripts to make figures. 
    - for the current version, all visualization scripts take one root directory with all analyzed data, which should be same as the one fed to the cli.py
    - jackknife, instead of bootstrap, is used for statistical analyses.

## Other Instructions

1. Jupyter Notebooks
    - two jupyter notebooks are included. Although they are earlier versions, not much has been changed in the Python script.
    - these notebooks are well annotated with step-by-step instructions and additional code.
    - Analyze_VF includes all preprocessing code
    - Grab_Bouts includes grab_fish_angle code

2. The grab fish angle code
    - it was originally written by DEE. This code extracts lots of data but most of which are not used in visualization.
    - the Python version saves variables into dataframe-like structures instead of individual lists
    - analyzed results (dataframes) are saved in "sheets" of hdf5 files. The .h5 file names should be self-explanatory. Refer to the catalog excel file for specific parameters.

3. Future changes
    - more visualization code will be added.
    - visualization scripts will be wraped in functions to make them callable.